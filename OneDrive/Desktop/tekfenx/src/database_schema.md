# مخطط قاعدة البيانات لنظام إدارة الموارد البشرية TEKFEN

## جداول قاعدة البيانات

### 1. جدول المستخدمين (users)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد للمستخدم (المفتاح الأساسي) |
| username | VARCHAR(50) | اسم المستخدم (فريد) |
| password_hash | VARCHAR(255) | تجزئة كلمة المرور المشفرة |
| email | VARCHAR(100) | البريد الإلكتروني (فريد) |
| first_name | VARCHAR(50) | الاسم الأول |
| last_name | VARCHAR(50) | اسم العائلة |
| role_id | INTEGER | معرف الدور (مفتاح خارجي) |
| department_id | INTEGER | معرف القسم (مفتاح خارجي) |
| position | VARCHAR(100) | المنصب الوظيفي |
| hire_date | DATE | تاريخ التعيين |
| phone | VARCHAR(20) | رقم الهاتف |
| profile_picture | VARCHAR(255) | مسار صورة الملف الشخصي |
| is_active | BOOLEAN | حالة المستخدم (نشط/غير نشط) |
| last_login | TIMESTAMP | آخر تسجيل دخول |
| created_at | TIMESTAMP | تاريخ إنشاء الحساب |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |
| language | VARCHAR(10) | اللغة المفضلة (ar/en) |

### 2. جدول الأدوار (roles)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد للدور (المفتاح الأساسي) |
| name | VARCHAR(50) | اسم الدور |
| description | TEXT | وصف الدور |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 3. جدول الصلاحيات (permissions)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد للصلاحية (المفتاح الأساسي) |
| name | VARCHAR(50) | اسم الصلاحية |
| description | TEXT | وصف الصلاحية |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 4. جدول علاقة الأدوار بالصلاحيات (role_permissions)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| role_id | INTEGER | معرف الدور (مفتاح خارجي) |
| permission_id | INTEGER | معرف الصلاحية (مفتاح خارجي) |
| created_at | TIMESTAMP | تاريخ الإنشاء |

### 5. جدول الأقسام (departments)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد للقسم (المفتاح الأساسي) |
| name | VARCHAR(100) | اسم القسم |
| manager_id | INTEGER | معرف مدير القسم (مفتاح خارجي) |
| description | TEXT | وصف القسم |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 6. جدول الحضور (attendance)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| user_id | INTEGER | معرف المستخدم (مفتاح خارجي) |
| check_in | TIMESTAMP | وقت تسجيل الحضور |
| check_out | TIMESTAMP | وقت تسجيل الانصراف |
| status | VARCHAR(20) | حالة الحضور (حاضر، متأخر، غائب) |
| note | TEXT | ملاحظات |
| created_by | INTEGER | معرف المستخدم الذي أنشأ السجل |
| updated_by | INTEGER | معرف المستخدم الذي عدل السجل |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 7. جدول الإجازات (leaves)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| user_id | INTEGER | معرف المستخدم (مفتاح خارجي) |
| leave_type_id | INTEGER | معرف نوع الإجازة (مفتاح خارجي) |
| start_date | DATE | تاريخ بداية الإجازة |
| end_date | DATE | تاريخ نهاية الإجازة |
| reason | TEXT | سبب الإجازة |
| status | VARCHAR(20) | حالة الطلب (معلق، موافق، مرفوض) |
| approved_by | INTEGER | معرف المستخدم الذي وافق على الطلب |
| approved_at | TIMESTAMP | تاريخ الموافقة |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 8. جدول أنواع الإجازات (leave_types)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| name | VARCHAR(50) | اسم نوع الإجازة |
| description | TEXT | وصف نوع الإجازة |
| days_allowed | INTEGER | عدد الأيام المسموح بها سنوياً |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 9. جدول الاستئذان (permissions_request)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| user_id | INTEGER | معرف المستخدم (مفتاح خارجي) |
| date | DATE | تاريخ الاستئذان |
| start_time | TIME | وقت بداية الاستئذان |
| end_time | TIME | وقت نهاية الاستئذان |
| reason | TEXT | سبب الاستئذان |
| status | VARCHAR(20) | حالة الطلب (معلق، موافق، مرفوض) |
| approved_by | INTEGER | معرف المستخدم الذي وافق على الطلب |
| approved_at | TIMESTAMP | تاريخ الموافقة |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 10. جدول الرواتب (salaries)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| user_id | INTEGER | معرف المستخدم (مفتاح خارجي) |
| basic_salary | DECIMAL(10,2) | الراتب الأساسي |
| allowances | DECIMAL(10,2) | البدلات |
| deductions | DECIMAL(10,2) | الخصومات |
| net_salary | DECIMAL(10,2) | صافي الراتب |
| month | INTEGER | الشهر |
| year | INTEGER | السنة |
| payment_date | DATE | تاريخ الدفع |
| status | VARCHAR(20) | حالة الراتب (مدفوع، معلق) |
| created_by | INTEGER | معرف المستخدم الذي أنشأ السجل |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 11. جدول شهادات الراتب (salary_certificates)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| user_id | INTEGER | معرف المستخدم (مفتاح خارجي) |
| request_date | DATE | تاريخ الطلب |
| purpose | TEXT | الغرض من الشهادة |
| status | VARCHAR(20) | حالة الطلب (معلق، مكتمل) |
| file_path | VARCHAR(255) | مسار ملف الشهادة |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 12. جدول المستندات (documents)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| user_id | INTEGER | معرف المستخدم (مفتاح خارجي) |
| title | VARCHAR(100) | عنوان المستند |
| description | TEXT | وصف المستند |
| file_path | VARCHAR(255) | مسار الملف |
| file_type | VARCHAR(50) | نوع الملف |
| file_size | INTEGER | حجم الملف بالبايت |
| is_private | BOOLEAN | خاص أم عام |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 13. جدول الدورات التدريبية (training_courses)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| title | VARCHAR(100) | عنوان الدورة |
| description | TEXT | وصف الدورة |
| start_date | DATE | تاريخ بداية الدورة |
| end_date | DATE | تاريخ نهاية الدورة |
| location | VARCHAR(100) | مكان الدورة |
| instructor | VARCHAR(100) | اسم المدرب |
| max_participants | INTEGER | الحد الأقصى للمشاركين |
| created_by | INTEGER | معرف المستخدم الذي أنشأ الدورة |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 14. جدول تسجيل الدورات (training_enrollments)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| user_id | INTEGER | معرف المستخدم (مفتاح خارجي) |
| course_id | INTEGER | معرف الدورة (مفتاح خارجي) |
| status | VARCHAR(20) | حالة التسجيل (معلق، مقبول، مرفوض، مكتمل) |
| enrollment_date | DATE | تاريخ التسجيل |
| completion_date | DATE | تاريخ الإكمال |
| certificate_path | VARCHAR(255) | مسار شهادة الدورة |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 15. جدول الإعلانات (announcements)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| title | VARCHAR(100) | عنوان الإعلان |
| content | TEXT | محتوى الإعلان |
| start_date | DATE | تاريخ بداية الإعلان |
| end_date | DATE | تاريخ نهاية الإعلان |
| is_active | BOOLEAN | حالة الإعلان (نشط/غير نشط) |
| created_by | INTEGER | معرف المستخدم الذي أنشأ الإعلان |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 16. جدول الرسائل (messages)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| sender_id | INTEGER | معرف المرسل (مفتاح خارجي) |
| receiver_id | INTEGER | معرف المستلم (مفتاح خارجي) |
| subject | VARCHAR(100) | موضوع الرسالة |
| content | TEXT | محتوى الرسالة |
| is_read | BOOLEAN | حالة القراءة |
| read_at | TIMESTAMP | تاريخ القراءة |
| attachment_path | VARCHAR(255) | مسار المرفق |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 17. جدول الشكاوى والاقتراحات (complaints)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| user_id | INTEGER | معرف المستخدم (مفتاح خارجي) |
| title | VARCHAR(100) | عنوان الشكوى/الاقتراح |
| description | TEXT | وصف الشكوى/الاقتراح |
| type | VARCHAR(20) | النوع (شكوى، اقتراح) |
| status | VARCHAR(20) | الحالة (جديد، قيد المراجعة، مكتمل) |
| assigned_to | INTEGER | معرف المستخدم المكلف بالمتابعة |
| resolution | TEXT | الحل أو الرد |
| created_at | TIMESTAMP | تاريخ الإنشاء |
| updated_at | TIMESTAMP | تاريخ آخر تحديث |

### 18. جدول سجلات النظام (logs)
| اسم الحقل | النوع | الوصف |
|-----------|------|-------|
| id | INTEGER | المعرف الفريد (المفتاح الأساسي) |
| user_id | INTEGER | معرف المستخدم (مفتاح خارجي) |
| action | VARCHAR(100) | الإجراء المتخذ |
| entity_type | VARCHAR(50) | نوع الكيان المتأثر |
| entity_id | INTEGER | معرف الكيان المتأثر |
| details | TEXT | تفاصيل الإجراء |
| ip_address | VARCHAR(45) | عنوان IP |
| user_agent | TEXT | معلومات المتصفح |
| created_at | TIMESTAMP | تاريخ الإنشاء |

## العلاقات بين الجداول

1. **المستخدمين والأدوار**: علاقة متعددة إلى واحد (N:1) - كل مستخدم له دور واحد، وكل دور يمكن أن يكون لعدة مستخدمين.

2. **الأدوار والصلاحيات**: علاقة متعددة إلى متعددة (N:M) - كل دور له عدة صلاحيات، وكل صلاحية يمكن أن تكون لعدة أدوار.

3. **المستخدمين والأقسام**: علاقة متعددة إلى واحد (N:1) - كل مستخدم ينتمي إلى قسم واحد، وكل قسم يمكن أن يضم عدة مستخدمين.

4. **المستخدمين والحضور**: علاقة واحد إلى متعددة (1:N) - كل مستخدم له عدة سجلات حضور، وكل سجل حضور ينتمي إلى مستخدم واحد.

5. **المستخدمين والإجازات**: علاقة واحد إلى متعددة (1:N) - كل مستخدم له عدة طلبات إجازة، وكل طلب إجازة ينتمي إلى مستخدم واحد.

6. **المستخدمين والاستئذان**: علاقة واحد إلى متعددة (1:N) - كل مستخدم له عدة طلبات استئذان، وكل طلب استئذان ينتمي إلى مستخدم واحد.

7. **المستخدمين والرواتب**: علاقة واحد إلى متعددة (1:N) - كل مستخدم له عدة سجلات رواتب، وكل سجل راتب ينتمي إلى مستخدم واحد.

8. **المستخدمين والمستندات**: علاقة واحد إلى متعددة (1:N) - كل مستخدم له عدة مستندات، وكل مستند ينتمي إلى مستخدم واحد.

9. **المستخدمين والدورات التدريبية**: علاقة متعددة إلى متعددة (N:M) - كل مستخدم يمكن أن يسجل في عدة دورات، وكل دورة يمكن أن تضم عدة مستخدمين.

10. **المستخدمين والرسائل**: علاقات متعددة - كل مستخدم يمكن أن يكون مرسل أو مستلم لعدة رسائل.

11. **المستخدمين والشكاوى**: علاقة واحد إلى متعددة (1:N) - كل مستخدم يمكن أن يقدم عدة شكاوى، وكل شكوى تنتمي إلى مستخدم واحد.

## تدفق المصادقة والصلاحيات

### 1. تسجيل الدخول
1. يقوم المستخدم بإدخال اسم المستخدم وكلمة المرور في صفحة تسجيل الدخول.
2. يتم التحقق من صحة بيانات الدخول مقابل قاعدة البيانات.
3. إذا كانت البيانات صحيحة، يتم إنشاء جلسة للمستخدم وتخزين معرف المستخدم ودوره في الجلسة.
4. يتم توجيه المستخدم إلى الصفحة الرئيسية المناسبة حسب دوره.
5. إذا كانت البيانات غير صحيحة، يتم عرض رسالة خطأ وإعادة المستخدم إلى صفحة تسجيل الدخول.

### 2. التحقق من الصلاحيات
1. عند كل طلب للوصول إلى صفحة أو وظيفة، يتم التحقق من دور المستخدم.
2. يتم استرجاع الصلاحيات المرتبطة بدور المستخدم من قاعدة البيانات.
3. يتم التحقق مما إذا كان المستخدم يملك الصلاحية المطلوبة للوصول إلى الصفحة أو الوظيفة.
4. إذا كان المستخدم يملك الصلاحية، يتم السماح بالوصول.
5. إذا لم يكن المستخدم يملك الصلاحية، يتم توجيهه إلى صفحة رفض الوصول.

### 3. إدارة المستخدمين
1. يمكن لمدير النظام فقط إضافة مستخدمين جدد.
2. عند إضافة مستخدم جديد، يتم تعيين دور له (مدير، مشرف، موظف).
3. يتم تشفير كلمة المرور قبل تخزينها في قاعدة البيانات.
4. يمكن لمدير النظام تعديل بيانات المستخدمين أو تعطيل حساباتهم.

### 4. تسجيل الخروج
1. عند النقر على زر تسجيل الخروج، يتم إنهاء جلسة المستخدم.
2. يتم توجيه المستخدم إلى صفحة تسجيل الدخول.

## الأدوار والصلاحيات الافتراضية

### 1. مدير النظام (Admin)
- إدارة المستخدمين (إضافة، تعديل، حذف)
- إدارة الأدوار والصلاحيات
- الوصول إلى جميع وظائف النظام
- عرض وتعديل جميع البيانات
- إدارة الإعلانات
- عرض سجلات النظام

### 2. مشرف (Supervisor)
- عرض قائمة الموظفين في قسمه
- الموافقة على طلبات الإجازة والاستئذان
- عرض وتعديل سجلات الحضور والغياب
- إدارة الشكاوى والاقتراحات
- إنشاء وإدارة الدورات التدريبية
- إنشاء الإعلانات

### 3. موظف (Employee)
- عرض وتعديل بياناته الشخصية
- تسجيل الحضور والانصراف
- تقديم طلبات الإجازة والاستئذان
- عرض تفاصيل الراتب وطلب شهادة راتب
- رفع وعرض المستندات الشخصية
- التسجيل في الدورات التدريبية
- إرسال واستقبال الرسائل
- تقديم الشكاوى والاقتراحات
